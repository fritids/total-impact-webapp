function Item(dict,itemView){var metricInfo={"citeulike:bookmarks":["scholars","saved","badge",3],"delicious:bookmarks":["public","saved","badge",3],"dryad:most_downloaded_file":["scholars","viewed","badge",100],"dryad:package_views":["scholars","viewed","badge",100],"dryad:total_downloads":["scholars","viewed","badge",100],"facebook:shares":["public","discussed","badge",3],"facebook:comments":["public","discussed","badge",3],"facebook:likes":["public","discussed","badge",3],"facebook:clicks":["public","discussed","badge",3],"github:forks":["public","cited","badge",3],"github:watchers":["public","saved","badge",3],"mendeley:career_stage":["","",0,0],"mendeley:country":["","",0,0],"mendeley:discipline":["","",0,0],"mendeley:student_readers":["scholars","saved",0,0],"mendeley:developing_countries":["scholars","saved",0,0],"mendeley:groups":["","",0,0],"mendeley:readers":["scholars","saved","badge",3],"plosalm:crossref":[],"plosalm:html_views":["public","viewed","badge",3],"plosalm:pdf_views":["scholars","viewed","badge",3],"plosalm:pmc_abstract":["","",0],"plosalm:pmc_figure":["","",0],"plosalm:pmc_full-text":["","",0],"plosalm:pmc_pdf":["","",0],"plosalm:pmc_supp-data":["","",0],"plosalm:pmc_unique-ip":["","",0],"plosalm:pubmed_central":["","",0],"plosalm:scopus":[],"pubmed:f1000":["scholars","recommended","badge",1],"pubmed:pmc_citations":["scholars","cited","badge",3],"pubmed:pmc_citations_editorials":["scholars","recommended","zoom",0],"pubmed:pmc_citations_reviews":["scholars","cited","zoom",0],"scienceseeker:blog_posts":["scholars","discussed","zoom",0],"researchblogging:blogs":["scholars","discussed",0,0],"slideshare:comments":["public","discussed","badge",3],"slideshare:downloads":["public","viewed","badge",3],"slideshare:favorites":["public","saved","badge",3],"slideshare:views":["public","viewed","badge",3],"topsy:influential_tweets":["public","discussed","zoom",0],"topsy:tweets":["public","discussed","badge",3],"wikipedia:mentions":["public","cited","badge",1]};this.developing_countries="Afghanistan|Albania|Algeria|Angola|Antigua and Barbuda|Argentina|Armenia|Azerbaijan|Bahamas|Bahrain|Bangladesh|Barbados|Belarus|Belize|Benin|Bhutan|Bolivia|Bosnia and Herzegovina|Botswana|Brazil|Brunei|Bulgaria|Burkina Faso|Burma|Burundi|Cambodia|Cameroon|Cape Verde|Central African Republic|Chad|Chile|China|Colombia|Comoros|Cuba|Democratic Republic of the Congo|Republic of the Congo|Costa Rica|Côte d Ivoire|Croatia|Djibouti|Dominica|Dominican Republic|Ecuador|Egypt|El Salvador|Equatorial Guinea|Eritrea|Ethiopia|Fiji|Gabon|The Gambia|Georgia|Ghana|Grenada|Guatemala|Guinea|Guinea-Bissau|Guyana|Haiti|Honduras|Hungary|India|Indonesia|Iran|Iraq|Jamaica|Jordan|Kazakhstan|Kenya|Kiribati|Kuwait|Kyrgyzstan|Laos|Latvia|Lebanon|Lesotho|Liberia|Libya|Lithuania|Macedonia|Madagascar|Malawi|Malaysia|Maldives|Mali|Marshall Islands|Mauritania|Mauritius|Mexico|Federated States of Micronesia|Moldova|Mongolia|Montenegro|Morocco|Mozambique|Namibia|Nauru|Nepal|Nicaragua|Niger|Nigeria|North Korea|Oman|Pakistan|Palau|Panama|Papua New Guinea|Paraguay|Peru|Philippines|Poland|Qatar|Romania|Russia|Rwanda|Saint Kitts and Nevis|Saint Lucia|Saint Vincent and the Grenadines|Samoa|São Tomé and Príncipe|Saudi Arabia|Senegal|Serbia|Seychelles|Sierra Leone|Solomon Islands|Somalia|South Africa|South Sudan|Sri Lanka|Sudan|Suriname|Swaziland|Syria|Tajikistan|Tanzania|Thailand|Timor-Leste|Togo|Tonga|Trinidad and Tobago|Tunisia|Turkey|Turkmenistan|Tuvalu|Uganda|Ukraine|United Arab Emirates|Uruguay|Uzbekistan|Vanuatu|Venezuela|Vietnam|Yemen|Zambia|Zimbabwe";this.render=function(){return this.itemView.render(this.dict)};this.makeEngagementTable=function(e,t){var n={scholars:{viewed:[],discussed:[],saved:[],cited:[],recommended:[]},"public":{viewed:[],discussed:[],saved:[],cited:[],recommended:[]}},r={viewed:"views",discussed:"discussion",saved:"saves",cited:"citation",recommended:"recommendation"};for(var i in e.metrics){var s=t[i][2];if(!s)continue;var o=t[i][0],u=t[i][1],a=this.dict.metrics[i];a.display=s;a.minNumForAward=t[i][3];n[o][u].push(a)}ret=[];for(var f in n){var l={audience:f,cells:[]};for(colName in n[f]){var c=n[f][colName];if(!c.length)continue;cellContents={metrics:c,engagementType:colName,engagementTypeNoun:r[colName],audience:f};l.cells.push(cellContents)}ret.push(l)}return{audiences:ret}};this.objToArr=function(e){var t=[];for(k in e)t.push(e[k]);return t};this.subractKeys=function(e,t){var n={};for(k in e)k in t||(n[k]=e[k]);return n};this.getsBigAward=function(e,t,n){console.log("does this get an award?");console.log(e);console.log(t);console.log(n);return n>=75&&e>=t?!0:e==="Yes"?!0:!1};this.makeAwards=function(e){var t={},n={};for(var r=0;r<e.audiences.length;r++){var i=e.audiences[r];for(var s=0;s<i.cells.length;s++){var o=i.cells[s];for(var u=0;u<o.metrics.length;u++){var a=o.metrics[u],f=i.audience+"."+o.engagementType,l=a.values.raw,c=a.minNumForAward;if(a.values.raw&&a.display=="badge"){if(a.percentiles!==undefined){var h=a.percentiles.CI95_lower;this.getsBigAward(l,c,h)&&(n[f]={audience:o.audience,engagementType:o.engagementType,minForAward:a.minNumForAward,engagementTypeNoun:o.engagementTypeNoun,metric:a})}if(f in n)continue;t[f]={audience:i.audience,engagementType:o.engagementType,metric:a}}}}}t=this.subractKeys(t,n);return{any:this.objToArr(t),big:this.objToArr(n)}};this.hasAwards=function(){return this.dict.awards.any.length||this.dict.awards.big.length};this.get_mendeley_percent=function(metricDict,key_substring){if(metricDict==undefined)return 0;var re=new RegExp(key_substring,"i");mendeleyRelevantKeys=metricDict.values.raw.filter(function(e){return e.name.match(re)});if(typeof mendeleyRelevantKeys[0]=="undefined")return 0;mendeleyPercentages=mendeleyRelevantKeys.map(function(e){return e.value});if(typeof mendeleyPercentages[0]=="undefined")return 0;sum=eval(mendeleyPercentages.join("+"));return sum};this.mendeley_reader_subset_count=function(e,t){if(typeof e["mendeley:readers"]=="undefined")return 0;t=="student"&&(percent=this.get_mendeley_percent(e["mendeley:career_stage"],"student"));t=="developing_countries"&&(percent=this.get_mendeley_percent(e["mendeley:country"],this.developing_countries));total_mendeley_readers=e["mendeley:readers"].values.raw;total=Math.round(total_mendeley_readers*percent/100);return total};this.update_metric=function(e,t,n){e.static_meta.display_name=t;e.values={};e.values.raw=n;return e};this.add_derived_metrics=function(e){var t=this.mendeley_reader_subset_count(e,"student");if(t>0){var n=$.extend(!0,{},e["mendeley:readers"]),r=this.update_metric(n,"readers: students",t);e["mendeley:student_readers"]=r}var t=this.mendeley_reader_subset_count(e,"developing_countries");if(t>0){var n=$.extend(!0,[],e["mendeley:readers"]),r=this.update_metric(n,"readers: developing countries",t);e["mendeley:developing_countries"]=r}return e};this.getMetricPercentiles=function(e,t){for(var n in e)e[n].percentiles=e[n].values[t];return e};this.dict=dict;this.dict.metrics=this.getMetricPercentiles(this.dict.metrics,"WoS");console.log(this.dict.biblio.title);this.dict.metrics=this.add_derived_metrics(this.dict.metrics);this.dict.engagementTable=this.makeEngagementTable(this.dict,metricInfo);console.log(this.dict.engagementTable);this.dict.awards=this.makeAwards(dict.engagementTable);this.itemView=itemView;return!0}function ItemView(){this.sortByMetricValueDesc=function(e,t){return typeof e.value!="number"?1:typeof t.value!="number"?-1:e.value<t.value?1:e.value>t.value?-1:0};this.renderBiblio=function(e,t){var n="";e.url=t;e.title=e.title||"no title";e.create_date&&(e.year=e.create_date.slice(0,4));if(e.authors){var r=e.authors.split(",",3).join(",");r.length<e.authors.length&&(r+=" et al.");e.authors=r}var i="biblio_"+e.genre;return $(ich[i](e,!0))};this.findBarLabelOffsets=function(e,t){var n=25,r=t-e;if(r<n)var i=r-n,s=i/2;else var s=0;return s};this.renderZoom=function(e){var t=$(ich.zoomTable(e,!0)),n=this;t.find("div.metric-perc-range.ci").each(function(){var e=$(this).find("span.endpoint.start span.value").text(),t=$(this).find("span.endpoint.end span.value").text(),r=n.findBarLabelOffsets(e,t);$(this).css({"margin-left":e+"%","margin-right":100-t+"%"}).find("span.endpoint.start").css("left",r+"px").end().find("span.endpoint.end").css("right",r+"px")});return t};this.renderBadges=function(e){var t=$(ich.badgesTemplate({big:e.big,any:e.any},!0));t.find(".ti-badge").tooltip();return t};this.render=function(e){var t=ich.displayItem(e),n=e.aliases.url?e.aliases.url[0]:!1,r=this.renderBiblio(e.biblio,n);t.find("div.biblio").append(r);var i=this.renderZoom(e.engagementTable,!0);t.find("div.zoom").append(i);var s=this.renderBadges(e.awards);t.find("div.badges").append(s);return t}}function ItemController(){var e=$("body");e.on("click","div.item-header",function(){$(this).parents("li.item").find("div.zoom").slideToggle(500,function(){$(this).parents("li.item").toggleClass("zoomed")});return!1});e.on("click","a.item-help",function(){$("#item-help-info").modal("show");return!1})};